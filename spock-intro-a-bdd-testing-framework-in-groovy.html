<!DOCTYPE html>
<!--
    Basically Basic Jekyll Theme 1.3.1
    Copyright 2017-2018 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/jekyll-basically-theme/blob/master/LICENSE.md
-->
<html lang="en-US" class="no-js">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
    <title>Spock Intro</title>
    <meta name="description" content="lessons learned managing developers">
    <link rel="canonical" href="https://edgibbs.com/spock-intro-a-bdd-testing-framework-in-groovy.html">
  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="/assets/stylesheets/main.css">
  

  
    
    <link rel="alternate" type="application/atom+xml" title="Musings of a Software Development Manager" href="/feed.xml">
  
</head>


  <body class="layout--page spock-intro">

    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>


    <div class="sidebar-toggle-wrapper">
      

      <button class="toggle navicon-button larr" type="button">
        <span class="toggle-inner">
          <span class="sidebar-toggle-label visually-hidden">Menu</span>
          <span class="navicon"></span>
        </span>
      </button>
    </div>

    <div id="sidebar" class="sidebar">
      <div class="inner">
        <nav id="primary-nav" class="site-nav" itemscope itemtype="http://schema.org/SiteNavigationElement" aria-label="Main navigation">
  <ul id="menu-main-navigation" class="menu">
    <!-- Home link -->
    <li class="menu-item">
      <a href="/" itemprop="url">
        <span itemprop="name">Home</span>
      </a>
    </li>

    <!-- site.pages links -->
    
    

    
      
      
    
      
      
        <li class="menu-item">
          <a href="/archive.html" itemprop="url">
            <span itemprop="name">Archive</span>
          </a>
        </li>
      
    
      
      
        <li class="menu-item">
          <a href="/bio.html" itemprop="url">
            <span itemprop="name">Bio</span>
          </a>
        </li>
      
    
      
      
    
      
      
        <li class="menu-item">
          <a href="/junit-4-with-hamcrest.html" itemprop="url">
            <span itemprop="name">JUnit 4 with Hamcrest</span>
          </a>
        </li>
      
    
      
      
        <li class="menu-item">
          <a href="/spock-intro-a-bdd-testing-framework-in-groovy.html" itemprop="url">
            <span itemprop="name">Spock Intro</span>
          </a>
        </li>
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
  </ul>
</nav>

        <ul class="contact-list">
  
    <li>
      <a href="mailto:ed@edgibbs.com">
        <span class="icon icon--email"><svg xmlns="http://www.w3.org/2000/svg" viewBox="313.1 3.7 16 16"><path d="M318.5 8.9c0-.2.2-.4.4-.4h4.5c.2 0 .4.2.4.4s-.2.4-.4.4h-4.5c-.3 0-.4-.2-.4-.4zm.4 2.1h4.5c.2 0 .4-.2.4-.4s-.2-.4-.4-.4h-4.5c-.2 0-.4.2-.4.4s.1.4.4.4zm3.5 1.2c0-.2-.2-.4-.4-.4h-3.1c-.2 0-.4.2-.4.4s.2.4.4.4h3.1c.2.1.4-.1.4-.4zm-1.5-8.4l-1.7 1.4c-.2.1-.2.4 0 .6s.4.2.6 0l1.4-1.2 1.4 1.2c.2.1.4.1.6 0s.1-.4 0-.6l-1.7-1.4c-.3-.1-.5-.1-.6 0zm7.8 6.2c.1.1.1.2.1.3v7.9c0 .8-.7 1.5-1.5 1.5h-12.5c-.8 0-1.5-.7-1.5-1.5v-7.9c0-.1.1-.2.1-.3l1.6-1.3c.2-.1.4-.1.6 0s.1.4 0 .6l-1.2 1 1.8 1.3v-4c0-.6.5-1.1 1.1-1.1h7.5c.6 0 1.1.5 1.1 1.1v4l1.8-1.3-1.2-1c-.2-.1-.2-.4 0-.6s.4-.2.6 0l1.6 1.3zm-11.6 2.2l4 2.8 4-2.8V7.6c0-.1-.1-.2-.2-.2h-7.5c-.1 0-.2.1-.2.2v4.6zm10.9-1l-4.7 3.4 3.4 2.6c.2.1.2.4.1.6-.1.2-.4.2-.6.1l-3.6-2.8-1.2.8c-.1.1-.3.1-.5 0l-1.2-.8-3.6 2.8c-.2.1-.4.1-.6-.1-.1-.2-.1-.4.1-.6l3.4-2.6-4.7-3.4v7.1c0 .4.3.6.6.6h12.5c.4 0 .6-.3.6-.6v-7.1z"/></svg></span>
        <span class="label">Email</span>
      </a>
    </li>
  

  
    <li><a href="https://github.com/edgibbs">
  <span class="icon icon--github"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M8 0C3.58 0 0 3.582 0 8c0 3.535 2.292 6.533 5.47 7.59.4.075.547-.172.547-.385 0-.19-.007-.693-.01-1.36-2.226.483-2.695-1.073-2.695-1.073-.364-.924-.89-1.17-.89-1.17-.725-.496.056-.486.056-.486.803.056 1.225.824 1.225.824.714 1.223 1.873.87 2.33.665.072-.517.278-.87.507-1.07-1.777-.2-3.644-.888-3.644-3.953 0-.873.31-1.587.823-2.147-.09-.202-.36-1.015.07-2.117 0 0 .67-.215 2.2.82.64-.178 1.32-.266 2-.27.68.004 1.36.092 2 .27 1.52-1.035 2.19-.82 2.19-.82.43 1.102.16 1.915.08 2.117.51.56.82 1.274.82 2.147 0 3.073-1.87 3.75-3.65 3.947.28.24.54.73.54 1.48 0 1.07-.01 1.93-.01 2.19 0 .21.14.46.55.38C13.71 14.53 16 11.53 16 8c0-4.418-3.582-8-8-8"/></svg></span>
  <span class="label">GitHub</span>
</a>
</li>
  

  
    <li><a href="https://www.linkedin.com/in/edwardgibbs">
  <span class="icon icon--linkedin"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M13.632 13.635h-2.37V9.922c0-.886-.018-2.025-1.234-2.025-1.235 0-1.424.964-1.424 1.96v3.778h-2.37V6H8.51v1.04h.03c.318-.6 1.092-1.233 2.247-1.233 2.4 0 2.845 1.58 2.845 3.637v4.188zM3.558 4.955c-.762 0-1.376-.617-1.376-1.377 0-.758.614-1.375 1.376-1.375.76 0 1.376.617 1.376 1.375 0 .76-.617 1.377-1.376 1.377zm1.188 8.68H2.37V6h2.376v7.635zM14.816 0H1.18C.528 0 0 .516 0 1.153v13.694C0 15.484.528 16 1.18 16h13.635c.652 0 1.185-.516 1.185-1.153V1.153C16 .516 15.467 0 14.815 0z" fill-rule="nonzero"/></svg></span>
  <span class="label">LinkedIn</span>
</a>
</li>
  

  
    <li><a href="https://ruby.social/@edgibbs">
  <img src="/images/icon-mastodon.svg" alt="Mastodon" height=24 width=24 />
  <span class="label">Mastodon</span>
</a>
</li>
  

  
    <li><a href="https://twitter.com/edward_gibbs">
  <span class="icon icon--twitter"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M16 3.038c-.59.26-1.22.437-1.885.517.677-.407 1.198-1.05 1.443-1.816-.634.37-1.337.64-2.085.79-.598-.64-1.45-1.04-2.396-1.04-1.812 0-3.282 1.47-3.282 3.28 0 .26.03.51.085.75-2.728-.13-5.147-1.44-6.766-3.42C.83 2.58.67 3.14.67 3.75c0 1.14.58 2.143 1.46 2.732-.538-.017-1.045-.165-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.22-.276.074-.566.114-.865.114-.21 0-.41-.02-.61-.058.42 1.304 1.63 2.253 3.07 2.28-1.12.88-2.54 1.404-4.07 1.404-.26 0-.52-.015-.78-.045 1.46.93 3.18 1.474 5.04 1.474 6.04 0 9.34-5 9.34-9.33 0-.14 0-.28-.01-.42.64-.46 1.2-1.04 1.64-1.7z" fill-rule="nonzero"/></svg></span>
  <span class="label">Twitter</span>
</a>
</li>
  

  <li>
    
      <a href="/feed.xml" title="Atom Feed">
        <span class="icon icon--rss"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M12.8 16C12.8 8.978 7.022 3.2 0 3.2V0c8.777 0 16 7.223 16 16h-3.2zM2.194 11.61c1.21 0 2.195.985 2.195 2.196 0 1.21-.99 2.194-2.2 2.194C.98 16 0 15.017 0 13.806c0-1.21.983-2.195 2.194-2.195zM10.606 16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818 0 10.606 4.79 10.606 10.607z"/></svg></span>
        <span class="label">Subscribe</span>
      </a>
    
  </li>
</ul>

      </div>
    </div>

    <div class="canvas">
      <div class="wrapper">
        

<header id="masthead">
  <div class="inner">
    <div class="title-area">
      
        <p class="site-title">
          <a href="/">
            <img src="/images/avatar.jpg" alt="" class="site-logo">
            <span>Musings of a Software Development Manager</span>
          </a>
        </p>
      
    </div>
  </div>
</header>

        <div class="initial-content">
          

<header class="intro">
  

  <div class="inner">
    <div class="intro-text">
      <h1 class="intro-title">Spock Intro
</h1>
      

      
        


        <p class="entry-meta">
          <span class="byline-item">by Ed Gibbs</span><span class="byline-item"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="379 72 16 16"><g><g><path fill="none" d="M380.8,86.7h12.3v-8.8h-12.3V86.7z M389.5,78.8h1.7v1.4h-1.7V78.8z M389.5,81.3h1.7v1.4h-1.7V81.3z M389.5,83.8h1.7v1.4h-1.7V83.8z M386.1,78.8h1.7v1.4h-1.7V78.8z M386.1,81.3h1.7v1.4h-1.7V81.3z M386.1,83.8h1.7v1.4h-1.7V83.8z M382.8,78.8h1.7v1.4h-1.7V78.8z M382.8,81.3h1.7v1.4h-1.7V81.3z M382.8,83.8h1.7v1.4h-1.7V83.8z"/><polygon fill="none" points="384.7 75.1 383.4 75.1 383.4 74.3 380.8 74.3 380.8 76.6 393.2 76.6 393.2 74.3 390.6 74.3 390.6 75.1 389.3 75.1 389.3 74.3 384.7 74.3"/><rect x="382.8" y="78.8" width="1.7" height="1.4"/><rect x="386.1" y="78.8" width="1.7" height="1.4"/><rect x="389.5" y="78.8" width="1.7" height="1.4"/><rect x="382.8" y="81.3" width="1.7" height="1.4"/><rect x="386.1" y="81.3" width="1.7" height="1.4"/><rect x="389.5" y="81.3" width="1.7" height="1.4"/><rect x="382.8" y="83.8" width="1.7" height="1.4"/><rect x="386.1" y="83.8" width="1.7" height="1.4"/><rect x="389.5" y="83.8" width="1.7" height="1.4"/><path d="M383.4,72v1.1h-3.8V88h14.9V73.1h-3.8V72h-1.3v1.1h-4.7V72H383.4z M393.2,86.7h-12.3v-8.8h12.3L393.2,86.7L393.2,86.7z M389.3,74.3v0.8h1.3v-0.8h2.5v2.3h-12.3v-2.3h2.5v0.8h1.3v-0.8H389.3z"/></g></g></svg></span><time datetime="2010-11-28T21:12:50+00:00">November 28, 2010</time></span>
        </p>
      

      

      
    </div>
  </div>
</header>




<main id="main" class="page-content" aria-label="Content">
  <div class="inner">
    <article class="entry-wrap">
      <div class="entry-content">
        <h3 id="a-bdd-testing-framework-in-groovy">A BDD Testing Framework in Groovy</h3>

<p>Spock is a welcome addition to the testing toolbox for Java developers. Historically JUnit 3 and 4 have been the dominant testing frameworks with TestNG making a small splash. All of these tools are traditional unit testing frameworks that setup state, invoke something, and then make assertions about the results. They are testing frameworks at their core so much so that JUnit 3 even required every method begin with the 4 little letters <strong>test</strong>. Spock brings a nice BDD (Behavior Driven Development) framework to Java land.</p>

<p>Behavior Driven Development is a movement to focus on the power of doing small bits of design incrementally by utilizing TDD. The very concept of the word test has some negative connotations and so it is dropped in BDD frameworks. J.B. Rainsberger has a <a href="http://www.jbrains.ca/permalink/the-worlds-shortest-article-on-behavior-driven-development-revisited">great quote</a> about BDD:</p>

<blockquote>
  <p>It is Test-Driven Development (TDD) practiced correctly; nothing more.</p>

  <p>— J.B. Rainsberger</p>
</blockquote>

<p>In many ways this is accurate. The goal of Behavior Driven Development is to focus on examples or specifications and not ‘tests’. The difference is semantic, but it can lead to some powerful realizations.</p>

<p>Though unit tests have become a common technique in the developer community, the true payoff of a TDD approach is significantly less common. Many developers get value out of adding suites of tests that cover regression issues, but the focus is often on adding the tests after the code and sometimes days or weeks after the production code was written.</p>

<p>So the BDD movement from which Spock springs has its’ roots in a tool in Java called JBehave. Historically <a href="http://jbehave.org/">JBehave</a> was the first of these frameworks, but Java has never been a first class language for expressing nice DSLs. The key framework which arose a little later in Ruby proved to be RSpec. RSpec took off over time and is now heavily used within the Ruby community. It focused on having nice sounding names for features and assertions using keywords like describe and method names like “should be able to login”. As Rainsberger and others have described it is entirely possible to write BDD style code even in Java especially with JUnit 4 syntax. You take the approach of giving very descriptive method names and assert nicer syntax with assertThat and the Hamcrest matchers. I myself often use this approach when embedded on a project with a large existing JUnit test suite. (see more about JUnit 4 with Hamcrest matchers for better syntax in <a href="/junit-4-with-hamcrest/">my tutorial</a>.)</p>

<p>Just for an example here’s a simple snippet of code in RSpec:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">describe</span> <span class="s2">"A new user"</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"should have a 5 free invites"</span> <span class="k">do</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span>
    <span class="n">user</span><span class="p">.</span><span class="nf">invites</span><span class="p">.</span><span class="nf">should</span> <span class="o">==</span> <span class="mi">5</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Spock is a newer BDD framework utilizing Groovy and running on the JVM. Though not very old it is rapidly picking up steam and being utilized by many developers who still code primarily in Java. It leverages heavily from earlier BDD frameworks like RSpec, but adds some nice syntactic sugar.</p>

<p>A classic code example is the following:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="s2">"should push 1 element onto FixedStack"</span><span class="o">()</span> <span class="o">{</span>
  <span class="nl">given:</span>
  <span class="kt">def</span> <span class="n">stack</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FixedStack</span><span class="o">()</span>

  <span class="nl">when:</span>
  <span class="n">stack</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="s2">"elem"</span><span class="o">)</span>

  <span class="nl">then:</span>
  <span class="n">stack</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span>
  <span class="n">stack</span><span class="o">.</span><span class="na">peek</span><span class="o">()</span> <span class="o">==</span> <span class="s2">"elem"</span>
<span class="o">}</span></code></pre></figure>

<p>It utilizes the same techniques of descriptive method names or features and adds the concept of given/when/then syntax for assertions. These follow along very well with the concept of user stories at a very low level. Another nicety is the ability to have parameterized data so that you can specify a number of scenarios without having lots of little tests. It handles exceptions with a bit of syntactic sugar. And much like RSpec it hands off to another framework for browser functional testing, in this case Geb.</p>

<p>To pursue extra expressiveness with Spock you can add descriptions to each block. Then you can read it like a step by step specification. One of the greatest features is the handling of failed specs. Instead of just showing a failed spec, it diagrams the assertions and draws nice vertical bars showing exactly what was specified and how the results differed from the expectations. That alone is a very compelling feature especially when with some test runners you end up having to look at the JUnit HTML reports to figure out why the test is really failing.</p>

<h3 id="spock-basics">Spock Basics</h3>

<p>To create a Spock spec you simply extend the spock.lang.Specification class from the framework. Since Spock takes advantage of JUnit 4 you can simply run it using JUnit runners or command line ant/maven. And it works with Eclipse, IntelliJ and others by just piggy backing on their support of JUnit. The first thing you would do is define a feature method which has slightly unusual syntax if you haven’t seen something like RSpec before:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="s2">"a user can be retrieved using their email"</span><span class="o">()</span> <span class="o">{}</span>

<span class="kt">def</span> <span class="s2">"adding a product to the shopping cart updates the total"</span><span class="o">()</span> <span class="o">{}</span>

<span class="kt">def</span> <span class="s2">"a user should be able to change their password"</span><span class="o">()</span> <span class="o">{}</span></code></pre></figure>

<p>It has a few traditional setup and cleanup methods:</p>

<ul>
  <li>setup() – run before every feature method</li>
  <li>cleanup() – run after every cleanup method</li>
  <li>setupSpec() – run before first feature</li>
  <li>cleanupSpec() – run after the last feature</li>
</ul>

<p>Blocks are the heart of the Spock and these are the core Spock blocks:</p>

<ul>
  <li>given: preconditions, data fixtures</li>
  <li>setup: alias for given (JUnit syntax)</li>
  <li>when: actions that trigger some outcome</li>
  <li>then: make assertions about the outcome</li>
  <li>expect: shorthand for when &amp; then</li>
  <li>where: applies varied inputs</li>
  <li>and: subdivides other blocks</li>
  <li>cleanup: post-conditions, housekeeping</li>
</ul>

<p>Spock follows a basic pattern for most specifications in regards to blocks. In general you have a given: block where you do some setup for the test. Next comes a when block where you actually execute the method you want to test. Then you have a then: block to make assertions that the state is as expected.</p>

<h3 id="spock-by-example">Spock By Example</h3>

<p>Let’s dive in with an example of how you might build a Spock specification. This hypothetical example is borrowed from an old JUnit book <a href="http://www.pragprog.com/titles/utj/pragmatic-unit-testing-in-java-with-junit">Pragmatic Unit Testing in Java with JUnit</a>. Say you wanted to build a Largest class which took a list of numbers and returned the largest number. Let’s start with a simple specification:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kn">package</span> <span class="nn">com.edgibbs.spock.tutorial</span>

<span class="kn">import</span> <span class="nn">spock.lang.Specification</span>

<span class="kd">class</span> <span class="nc">LargestSpec</span> <span class="kd">extends</span> <span class="n">Specification</span> <span class="o">{</span>

  <span class="kt">def</span> <span class="s2">"Largest number should be returned when first in list"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">when:</span>
    <span class="kt">def</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([</span><span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">])</span>

    <span class="nl">then:</span>
    <span class="n">largest</span> <span class="o">==</span> <span class="mi">3</span>
  <span class="o">}</span></code></pre></figure>

<p>Obviously this will fail initially so we’ll start a bare bones largest class to pass this test:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="kn">package</span> <span class="nn">com.edgibbs.spock.tutorial</span>

<span class="kd">class</span> <span class="nc">Largest</span> <span class="o">{</span>

  <span class="kt">def</span> <span class="kd">static</span> <span class="nf">max</span><span class="o">(</span><span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="mi">3</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>OK, now onto the second spec:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy">  <span class="kt">def</span> <span class="s2">"Largest number should be returned regardless of order"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">expect:</span>
    <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([</span><span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">,</span> <span class="n">third</span><span class="o">])</span> <span class="o">==</span> <span class="n">largest</span>

    <span class="nl">where:</span>
    <span class="n">first</span> <span class="o">&lt;</span> <span class="o">&lt;</span> <span class="o">[</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">8</span><span class="o">]</span>
    <span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mi">4</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">2</span><span class="o">]</span>
    <span class="n">third</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mi">8</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">]</span>
    <span class="n">largest</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">]</span>

  <span class="o">}</span></code></pre></figure>

<p>So here we have some some new features from Spock. At first this code can be a bit of a handful, but we’ll walk through all the code. So our when: and then: blocks are missing now replaced with expect: and where:. The expect: block is just a shorthand for then: and when:. Next comes the where: block. The where: block allows you to vary the input to the when: or expect: block. So you can setup multiple scenarios in a single specification. The first time through it runns the following assertion taking the first element in each list:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy">  <span class="nl">expect:</span>
  <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">[</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">8</span><span class="o">]</span> <span class="o">==</span> <span class="mi">8</span></code></pre></figure>

<p>The second time through:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy">  <span class="nl">expect:</span>
  <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">[</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">8</span><span class="o">]</span> <span class="o">==</span> <span class="mi">8</span></code></pre></figure>

<p>This can be very helpful testing similar scenarios without having to write a lot of smaller tests. Not something you use constantly, but occasionally very nice. Running this test yields our first failure:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="n">Condition</span> <span class="n">not</span> <span class="nl">satisfied:</span>

<span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([</span><span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">,</span> <span class="n">third</span><span class="o">])</span> <span class="o">==</span> <span class="n">largest</span>
        <span class="o">|</span>    <span class="o">|</span>      <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>  <span class="o">|</span>
        <span class="mi">3</span>    <span class="mi">2</span>      <span class="mi">4</span>       <span class="mi">8</span>       <span class="o">|</span>  <span class="mi">8</span>
                                    <span class="kc">false</span>

  <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">edgibbs</span><span class="o">.</span><span class="na">spock</span><span class="o">.</span><span class="na">tutorial</span><span class="o">.</span><span class="na">LargestSpec</span><span class="o">.</span><span class="na">Largest</span> <span class="n">number</span> <span class="n">should</span> <span class="n">be</span> <span class="n">returned</span> <span class="n">regardless</span> <span class="n">of</span> <span class="nf">order</span><span class="o">(</span><span class="n">LargestSpec</span><span class="o">.</span><span class="na">groovy</span></code></pre></figure>

<p>The best part here is the error message tells you exactly why the assertion failed with a nice visual text representation. Time to fix our naive implementation and get the test passing:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"> <span class="kt">def</span> <span class="kd">static</span> <span class="nf">max</span><span class="o">(</span><span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">maximum</span> <span class="o">=</span>
    <span class="n">list</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span><span class="n">item</span> <span class="o">-&gt;</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">item</span> <span class="o">&gt;</span> <span class="n">maximum</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">maximum</span> <span class="o">=</span> <span class="n">item</span>
       <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">maximum</span>
  <span class="o">}</span></code></pre></figure>

<p>Now our test passes for all of scenarios. Before moving on we might want to look at a little refactoring that Spock allows for to make our test read a bit better. Currently we’re making assertions using lists in the test, but we can also use a nicer table like syntax for all of the inputs and assertion values. It looks much like the table format used in <a href="http://fitnesse.org/">Fitnesse</a>. So our slightly refactored test now looks like:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="s2">"Largest number should be returned regardless of order"</span><span class="o">()</span> <span class="o">{</span>
  <span class="nl">expect:</span>
  <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([</span><span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">,</span> <span class="n">third</span><span class="o">])</span> <span class="o">==</span> <span class="n">largest</span>

  <span class="nl">where:</span>
  <span class="n">first</span> <span class="o">|</span> <span class="n">second</span> <span class="o">|</span> <span class="n">third</span> <span class="o">|</span> <span class="n">largest</span>
    <span class="mi">2</span>   <span class="o">|</span>    <span class="mi">4</span>   <span class="o">|</span>   <span class="mi">8</span>   <span class="o">|</span>    <span class="mi">8</span>
    <span class="mi">4</span>   <span class="o">|</span>    <span class="mi">8</span>   <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>    <span class="mi">8</span>
    <span class="mi">8</span>   <span class="o">|</span>    <span class="mi">2</span>   <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>    <span class="mi">8</span>
  <span class="o">}</span></code></pre></figure>

<p>Running the refactored test passes and so we’re onto brainstorming a few more tests:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="s2">"Largest number should be returned even with duplicates"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">expect:</span>
    <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([</span><span class="mi">8</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">])</span> <span class="o">==</span> <span class="mi">8</span>
<span class="o">}</span></code></pre></figure>

<p>Here we use the simplest block syntax using just an expect: block. This passes so we move onto another test say of only a single entry in the list:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="s2">"Largest number should work with only a single entry"</span><span class="o">()</span> <span class="o">{</span>
  <span class="nl">when:</span>
  <span class="kt">def</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([</span><span class="mi">1</span><span class="o">])</span>

  <span class="nl">then:</span>
  <span class="n">largest</span> <span class="o">==</span> <span class="mi">1</span>
<span class="o">}</span></code></pre></figure>

<p>Again this passes. So thinking of negative cases let’s try a larger list:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="s2">"Largest number with a 10 item list should work"</span><span class="o">()</span> <span class="o">{</span>
  <span class="nl">given:</span>
  <span class="kt">def</span> <span class="n">list</span> <span class="o">=</span> <span class="o">[,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">9</span><span class="o">]</span>

  <span class="nl">when:</span>
  <span class="kt">def</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">list</span><span class="o">)</span>

  <span class="nl">then:</span>
  <span class="n">largest</span> <span class="o">==</span> <span class="mi">9</span>
<span class="o">}</span></code></pre></figure>

<p>This test passes as well. Note we’ve used the given: when: then: pattern here to write a very clear spec. OK, time to try a few more negative test cases: How about a list of negative numbers:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="s2">"Largest will return correct negative numbers"</span><span class="o">()</span> <span class="o">{</span>
  <span class="nl">when:</span>
  <span class="kt">def</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([-</span><span class="mi">9</span><span class="o">,</span> <span class="o">-</span><span class="mi">8</span><span class="o">,</span> <span class="o">-</span><span class="mi">7</span><span class="o">])</span>

  <span class="nl">then:</span>
  <span class="n">largest</span> <span class="o">==</span> <span class="o">-</span><span class="mi">7</span>
<span class="o">}</span></code></pre></figure>

<p>Here we get another failure:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="n">Condition</span> <span class="n">not</span> <span class="nl">satisfied:</span>

<span class="n">largest</span> <span class="o">==</span> <span class="o">-</span><span class="mi">7</span>
<span class="o">|</span>       <span class="o">|</span>
<span class="mi">0</span>       <span class="kc">false</span>

  <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">edgibbs</span><span class="o">.</span><span class="na">spock</span><span class="o">.</span><span class="na">tutorial</span><span class="o">.</span><span class="na">LargestSpec</span><span class="o">.</span><span class="na">Largest</span> <span class="n">will</span> <span class="k">return</span> <span class="n">correct</span> <span class="n">negative</span> <span class="nf">numbers</span><span class="o">(</span><span class="n">LargestSpec</span><span class="o">.</span><span class="na">groovy</span><span class="o">:</span><span class="mi">60</span><span class="o">)</span></code></pre></figure>

<p>This forces us to change our naive implementation. Let’s not set maximum to zero initially.</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="kd">static</span> <span class="nf">max</span><span class="o">(</span><span class="n">list</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">def</span> <span class="n">maximum</span>
  <span class="n">list</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span><span class="n">item</span> <span class="o">-&gt;</span>
     <span class="k">if</span> <span class="o">(</span><span class="n">item</span> <span class="o">&gt;</span> <span class="n">maximum</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">maximum</span> <span class="o">=</span> <span class="n">item</span>
     <span class="o">}</span>
  <span class="o">}</span>
  <span class="n">maximum</span>
<span class="o">}</span></code></pre></figure>

<p>Now with our test passing it’s time to handle cases like passing in an empty list. We’d like to throw an exception if our max method get an empty list so the spec looks like the following:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="s2">"Largest will fail on an empty list with error message"</span><span class="o">()</span> <span class="o">{</span>
  <span class="nl">when:</span>
  <span class="kt">def</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([])</span>

  <span class="nl">then:</span>
  <span class="n">RuntimeException</span> <span class="n">error</span> <span class="o">=</span> <span class="n">thrown</span><span class="o">()</span>
  <span class="n">error</span><span class="o">.</span><span class="na">message</span> <span class="o">==</span> <span class="s2">"max: Empty List"</span>
<span class="o">}</span></code></pre></figure>

<p>This fails of course because no exception was thrown. The thrown() syntax here is a Spock method that sets up an expectation of an error being thrown. It can even return the error allowing you to check the message. So we need to implement a simple exception handling in Largest.</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="kd">static</span> <span class="nf">max</span><span class="o">(</span><span class="n">list</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">def</span> <span class="n">maximum</span>
  <span class="nf">if</span> <span class="o">(</span><span class="n">list</span><span class="o">?.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s2">"max: Empty List"</span><span class="o">)</span>
  <span class="o">}</span>
  <span class="n">list</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span><span class="n">item</span> <span class="o">-&gt;</span>
     <span class="k">if</span> <span class="o">(</span><span class="n">item</span> <span class="o">&gt;</span> <span class="n">maximum</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">maximum</span> <span class="o">=</span> <span class="n">item</span>
     <span class="o">}</span>
  <span class="o">}</span>
  <span class="n">maximum</span>
<span class="o">}</span></code></pre></figure>

<p>Last let’s finish with passing in a null and expecting that we’ll get back a zero. We also want to avoid any NullPointerException so we’ll check that we don’t see one of those. The last test looks like:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="s2">"Passing in a null should return zero "</span><span class="o">()</span> <span class="o">{</span>
  <span class="nl">when:</span>
  <span class="kt">def</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="kc">null</span><span class="o">)</span>

  <span class="nl">then:</span>
  <span class="n">notThrown</span><span class="o">(</span><span class="n">NullPointerException</span><span class="o">)</span>
  <span class="n">largest</span> <span class="o">==</span> 
<span class="o">}</span></code></pre></figure>

<p>The notThrown() method does what you’d expect. It checks that an NPE is not thrown in this case. That assertion actually passes, but it doesn’t return what we expected:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="n">Condition</span> <span class="n">not</span> <span class="nl">satisfied:</span>

<span class="n">largest</span> <span class="o">==</span> <span class="mi">0</span>
<span class="o">|</span>       <span class="o">|</span>
<span class="kc">null</span>    <span class="kc">false</span>

  <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">edgibbs</span><span class="o">.</span><span class="na">spock</span><span class="o">.</span><span class="na">tutorial</span><span class="o">.</span><span class="na">LargestSpec</span><span class="o">.</span><span class="na">What</span> <span class="k">if</span> <span class="n">we</span> <span class="n">pass</span> <span class="k">in</span> <span class="nf">null</span><span class="o">(</span><span class="n">LargestSpec</span><span class="o">.</span><span class="na">groovy</span><span class="o">:</span><span class="mi">106</span><span class="o">)</span></code></pre></figure>

<p>Turns out we need to set the default to return zero in this sort of case. So we change Largest slightly again:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="kd">static</span> <span class="nf">max</span><span class="o">(</span><span class="n">list</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">def</span> <span class="n">maximum</span> <span class="o">=</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">list</span><span class="o">?.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s2">"max: Empty List"</span><span class="o">)</span>
  <span class="o">}</span>
  <span class="n">list</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span><span class="n">item</span> <span class="o">-&gt;</span>
     <span class="k">if</span> <span class="o">(</span><span class="n">item</span> <span class="o">&gt;</span> <span class="n">maximum</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">maximum</span> <span class="o">=</span> <span class="n">item</span>
     <span class="o">}</span>
  <span class="o">}</span>
  <span class="n">maximum</span>
<span class="o">}</span></code></pre></figure>

<p>That passes, but now we’ve broken another the test case for negative numbers:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="n">Condition</span> <span class="n">not</span> <span class="nl">satisfied:</span>

<span class="n">largest</span> <span class="o">==</span> <span class="o">-</span><span class="mi">7</span>
<span class="o">|</span>       <span class="o">|</span>
<span class="mi">0</span>       <span class="kc">false</span>

  <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">edgibbs</span><span class="o">.</span><span class="na">spock</span><span class="o">.</span><span class="na">tutorial</span><span class="o">.</span><span class="na">LargestSpec</span><span class="o">.</span><span class="na">Largest</span> <span class="n">will</span> <span class="k">return</span> <span class="n">correct</span> <span class="n">negative</span> <span class="nf">numbers</span><span class="o">(</span><span class="n">LargestSpec</span><span class="o">.</span><span class="na">groovy</span><span class="o">:</span><span class="mi">60</span><span class="o">)</span></code></pre></figure>

<p>OK, maybe we should rethink passing in nulls should have the same behavior as passing an empty list so we should just return an error.</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"> <span class="kt">def</span> <span class="s2">"Should return exception if passing in null"</span><span class="o">()</span> <span class="o">{</span>
  <span class="nl">when:</span>
  <span class="kt">def</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="kc">null</span><span class="o">)</span>

  <span class="nl">then:</span>
  <span class="n">RuntimeException</span> <span class="n">error</span> <span class="o">=</span> <span class="n">thrown</span><span class="o">()</span>
  <span class="n">error</span><span class="o">.</span><span class="na">message</span> <span class="o">==</span> <span class="s2">"max: Empty List"</span>
<span class="o">}</span></code></pre></figure>

<p>Now we need to make the change to the max() method again to get all the tests passing hopefully.</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="kd">static</span> <span class="nf">max</span><span class="o">(</span><span class="n">list</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">def</span> <span class="n">maximum</span>
  <span class="nf">if</span> <span class="o">(!</span><span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s2">"max: Empty List"</span><span class="o">)</span>
  <span class="o">}</span>
  <span class="n">list</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span><span class="n">item</span> <span class="o">-&gt;</span>
     <span class="k">if</span> <span class="o">(</span><span class="n">item</span> <span class="o">&gt;</span> <span class="n">maximum</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">maximum</span> <span class="o">=</span> <span class="n">item</span>
     <span class="o">}</span>
  <span class="o">}</span>
  <span class="n">maximum</span>
<span class="o">}</span></code></pre></figure>

<p>Now all the tests pass successfully. The final classes look like:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
</pre></td><td class="code"><pre><span class="kn">package</span> <span class="nn">com.edgibbs.spock.tutorial</span>

<span class="kn">import</span> <span class="nn">spock.lang.Specification</span>

<span class="kd">class</span> <span class="nc">LargestSpec</span> <span class="kd">extends</span> <span class="n">Specification</span> <span class="o">{</span>

  <span class="kt">def</span> <span class="s2">"Largest number should be returned when first in list"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">when:</span>
    <span class="kt">def</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([</span><span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">])</span>

    <span class="nl">then:</span>
    <span class="n">largest</span> <span class="o">==</span> <span class="mi">3</span>
  <span class="o">}</span>

  <span class="kt">def</span> <span class="s2">"Largest number should be returned regardless of order"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">expect:</span>
    <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([</span><span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">,</span> <span class="n">third</span><span class="o">])</span> <span class="o">==</span> <span class="n">largest</span>

    <span class="nl">where:</span>
    <span class="n">first</span> <span class="o">|</span> <span class="n">second</span> <span class="o">|</span> <span class="n">third</span> <span class="o">|</span> <span class="n">largest</span>
      <span class="mi">2</span>   <span class="o">|</span>    <span class="mi">4</span>   <span class="o">|</span>   <span class="mi">8</span>   <span class="o">|</span>    <span class="mi">8</span>
      <span class="mi">4</span>   <span class="o">|</span>    <span class="mi">8</span>   <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>    <span class="mi">8</span>
      <span class="mi">8</span>   <span class="o">|</span>    <span class="mi">2</span>   <span class="o">|</span>   <span class="mi">4</span>   <span class="o">|</span>    <span class="mi">8</span>
  <span class="o">}</span>

  <span class="kt">def</span> <span class="s2">"Largest number should be returned even with duplicates"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">expect:</span>
    <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([</span><span class="mi">8</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">])</span> <span class="o">==</span> <span class="mi">8</span>
  <span class="o">}</span>

  <span class="kt">def</span> <span class="s2">"Largest number should work with only a single entry"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">when:</span>
    <span class="kt">def</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([</span><span class="mi">1</span><span class="o">])</span>

    <span class="nl">then:</span>
    <span class="n">largest</span> <span class="o">==</span> <span class="mi">1</span>
  <span class="o">}</span>

  <span class="kt">def</span> <span class="s2">"Largest number with a 10 item list should work"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">given:</span>
    <span class="kt">def</span> <span class="n">list</span> <span class="o">=</span> <span class="o">[,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">9</span><span class="o">]</span>

    <span class="nl">when:</span>
    <span class="kt">def</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">list</span><span class="o">)</span>

    <span class="nl">then:</span>
    <span class="n">largest</span> <span class="o">==</span> <span class="mi">9</span>
  <span class="o">}</span>

  <span class="kt">def</span> <span class="s2">"Largest will return correct negative numbers"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">when:</span>
    <span class="kt">def</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([-</span><span class="mi">9</span><span class="o">,</span> <span class="o">-</span><span class="mi">8</span><span class="o">,</span> <span class="o">-</span><span class="mi">7</span><span class="o">])</span>

    <span class="nl">then:</span>
    <span class="n">largest</span> <span class="o">==</span> <span class="o">-</span><span class="mi">7</span>
  <span class="o">}</span>

  <span class="kt">def</span> <span class="s2">"Largest will fail on an empty list"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">when:</span>
    <span class="kt">def</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([])</span>

    <span class="nl">then:</span>
    <span class="n">thrown</span><span class="o">(</span><span class="n">RuntimeException</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="kt">def</span> <span class="s2">"Largest will fail on an empty list with error message"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">when:</span>
    <span class="kt">def</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">([])</span>

    <span class="nl">then:</span>
    <span class="n">RuntimeException</span> <span class="n">error</span> <span class="o">=</span> <span class="n">thrown</span><span class="o">()</span>
    <span class="n">error</span><span class="o">.</span><span class="na">message</span> <span class="o">==</span> <span class="s2">"max: Empty List"</span>
  <span class="o">}</span>

  <span class="kt">def</span> <span class="s2">"Should return exception if passing in null"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">when:</span>
    <span class="kt">def</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">Largest</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="kc">null</span><span class="o">)</span>

    <span class="nl">then:</span>
    <span class="n">RuntimeException</span> <span class="n">error</span> <span class="o">=</span> <span class="n">thrown</span><span class="o">()</span>
    <span class="n">error</span><span class="o">.</span><span class="na">message</span> <span class="o">==</span> <span class="s2">"max: Empty List"</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>The implementation class for Largest:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre><span class="kn">package</span> <span class="nn">com.edgibbs.spock.tutorial</span>

<span class="kd">class</span> <span class="nc">Largest</span> <span class="o">{</span>

  <span class="kt">def</span> <span class="kd">static</span> <span class="nf">max</span><span class="o">(</span><span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">maximum</span>
    <span class="nf">if</span> <span class="o">(!</span><span class="n">list</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s2">"max: Empty List"</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="n">list</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span><span class="n">item</span> <span class="o">-&gt;</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">item</span> <span class="o">&gt;</span> <span class="n">maximum</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">maximum</span> <span class="o">=</span> <span class="n">item</span>
       <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">maximum</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="additional-note-on-spocks-block-syntax">Additional Note On Spock’s Block Syntax</h3>

<p>Spock’s block given/when/then syntax is a key feature I got asked a while back in a presentation on whether this was just Groovy syntax that he didn’t know. I replied that I wasn’t aware of it, and I wasn’t quite sure how they did it. That little itch eventually turned into diving head first into the source code to figure out how it came about. I expected I would be looking at some typical DSL Expando metaclass stuff.</p>

<p>It turns out Spock is using AST Transformation that got added to Groovy 1.6. The labels like given: or when: are transformed by Spock before they get compiled down to bytecode. This allows you to have a nice expressive syntax with a simple block structure.</p>

      </div>
    </article>
  </div>
</main>

        </div>

        <div class="search-content">
          <div class="inner">
  
</div>

        </div>
      </div>
    </div>

    

<script async src="/assets/javascripts/main.js"></script>




  </body>

</html>

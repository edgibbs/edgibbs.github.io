<!DOCTYPE html>
<!--
    Basically Basic Jekyll Theme 1.3.1
    Copyright 2017-2018 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/jekyll-basically-theme/blob/master/LICENSE.md
-->
<html lang="en-US" class="no-js">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
    <title>Musings of a Software Development Manager</title>
    <meta name="description" content="lessons learned managing developers">
    <link rel="canonical" href="https://edgibbs.com/page12/">
  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="/assets/stylesheets/main.css">
  

  
    
    <link rel="alternate" type="application/atom+xml" title="Musings of a Software Development Manager" href="/feed.xml">
  
</head>


  <body class="layout--home ">

    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>


    <div class="sidebar-toggle-wrapper">
      <button class="toggle navicon-button larr" type="button">
        <span class="toggle-inner">
          <span class="sidebar-toggle-label visually-hidden">Menu</span>
          <span class="navicon"></span>
        </span>
      </button>
    </div>

    <div id="sidebar" class="sidebar">
      <div class="inner">
        <nav id="primary-nav" class="site-nav" itemscope itemtype="http://schema.org/SiteNavigationElement" aria-label="Main navigation">
  <ul id="menu-main-navigation" class="menu">
    <!-- Home link -->
    <li class="menu-item">
      <a href="/" itemprop="url">
        <span itemprop="name">Home</span>
      </a>
    </li>

    <!-- site.pages links -->
    
    

    
      
      
    
      
      
        <li class="menu-item">
          <a href="/archive.html" itemprop="url">
            <span itemprop="name">Archive</span>
          </a>
        </li>
      
    
      
      
        <li class="menu-item">
          <a href="/bio.html" itemprop="url">
            <span itemprop="name">Bio</span>
          </a>
        </li>
      
    
      
      
    
      
      
        <li class="menu-item">
          <a href="/junit-4-with-hamcrest.html" itemprop="url">
            <span itemprop="name">JUnit 4 with Hamcrest</span>
          </a>
        </li>
      
    
      
      
    
      
      
    
      
      
        <li class="menu-item">
          <a href="/spock-intro-a-bdd-testing-framework-in-groovy.html" itemprop="url">
            <span itemprop="name">Spock Intro</span>
          </a>
        </li>
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
  </ul>
</nav>

        <ul class="contact-list">
  
    <li>
      <a href="mailto:ed@edgibbs.com">
        <span class="icon icon--email"><svg xmlns="http://www.w3.org/2000/svg" viewBox="313.1 3.7 16 16"><path d="M318.5 8.9c0-.2.2-.4.4-.4h4.5c.2 0 .4.2.4.4s-.2.4-.4.4h-4.5c-.3 0-.4-.2-.4-.4zm.4 2.1h4.5c.2 0 .4-.2.4-.4s-.2-.4-.4-.4h-4.5c-.2 0-.4.2-.4.4s.1.4.4.4zm3.5 1.2c0-.2-.2-.4-.4-.4h-3.1c-.2 0-.4.2-.4.4s.2.4.4.4h3.1c.2.1.4-.1.4-.4zm-1.5-8.4l-1.7 1.4c-.2.1-.2.4 0 .6s.4.2.6 0l1.4-1.2 1.4 1.2c.2.1.4.1.6 0s.1-.4 0-.6l-1.7-1.4c-.3-.1-.5-.1-.6 0zm7.8 6.2c.1.1.1.2.1.3v7.9c0 .8-.7 1.5-1.5 1.5h-12.5c-.8 0-1.5-.7-1.5-1.5v-7.9c0-.1.1-.2.1-.3l1.6-1.3c.2-.1.4-.1.6 0s.1.4 0 .6l-1.2 1 1.8 1.3v-4c0-.6.5-1.1 1.1-1.1h7.5c.6 0 1.1.5 1.1 1.1v4l1.8-1.3-1.2-1c-.2-.1-.2-.4 0-.6s.4-.2.6 0l1.6 1.3zm-11.6 2.2l4 2.8 4-2.8V7.6c0-.1-.1-.2-.2-.2h-7.5c-.1 0-.2.1-.2.2v4.6zm10.9-1l-4.7 3.4 3.4 2.6c.2.1.2.4.1.6-.1.2-.4.2-.6.1l-3.6-2.8-1.2.8c-.1.1-.3.1-.5 0l-1.2-.8-3.6 2.8c-.2.1-.4.1-.6-.1-.1-.2-.1-.4.1-.6l3.4-2.6-4.7-3.4v7.1c0 .4.3.6.6.6h12.5c.4 0 .6-.3.6-.6v-7.1z"/></svg></span>
        <span class="label">Email</span>
      </a>
    </li>
  

  
    <li><a href="https://github.com/edgibbs">
  <span class="icon icon--github"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M8 0C3.58 0 0 3.582 0 8c0 3.535 2.292 6.533 5.47 7.59.4.075.547-.172.547-.385 0-.19-.007-.693-.01-1.36-2.226.483-2.695-1.073-2.695-1.073-.364-.924-.89-1.17-.89-1.17-.725-.496.056-.486.056-.486.803.056 1.225.824 1.225.824.714 1.223 1.873.87 2.33.665.072-.517.278-.87.507-1.07-1.777-.2-3.644-.888-3.644-3.953 0-.873.31-1.587.823-2.147-.09-.202-.36-1.015.07-2.117 0 0 .67-.215 2.2.82.64-.178 1.32-.266 2-.27.68.004 1.36.092 2 .27 1.52-1.035 2.19-.82 2.19-.82.43 1.102.16 1.915.08 2.117.51.56.82 1.274.82 2.147 0 3.073-1.87 3.75-3.65 3.947.28.24.54.73.54 1.48 0 1.07-.01 1.93-.01 2.19 0 .21.14.46.55.38C13.71 14.53 16 11.53 16 8c0-4.418-3.582-8-8-8"/></svg></span>
  <span class="label">GitHub</span>
</a>
</li>
  

  
    <li><a href="https://www.linkedin.com/in/edwardgibbs">
  <span class="icon icon--linkedin"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M13.632 13.635h-2.37V9.922c0-.886-.018-2.025-1.234-2.025-1.235 0-1.424.964-1.424 1.96v3.778h-2.37V6H8.51v1.04h.03c.318-.6 1.092-1.233 2.247-1.233 2.4 0 2.845 1.58 2.845 3.637v4.188zM3.558 4.955c-.762 0-1.376-.617-1.376-1.377 0-.758.614-1.375 1.376-1.375.76 0 1.376.617 1.376 1.375 0 .76-.617 1.377-1.376 1.377zm1.188 8.68H2.37V6h2.376v7.635zM14.816 0H1.18C.528 0 0 .516 0 1.153v13.694C0 15.484.528 16 1.18 16h13.635c.652 0 1.185-.516 1.185-1.153V1.153C16 .516 15.467 0 14.815 0z" fill-rule="nonzero"/></svg></span>
  <span class="label">LinkedIn</span>
</a>
</li>
  

  
    <li><a href="https://ruby.social/@edgibbs">
  <img src="/images/icon-mastodon.svg" alt="Mastodon" height=24 width=24 />
  <span class="label">Mastodon</span>
</a>
</li>
  

  
    <li><a href="https://twitter.com/edward_gibbs">
  <span class="icon icon--twitter"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M16 3.038c-.59.26-1.22.437-1.885.517.677-.407 1.198-1.05 1.443-1.816-.634.37-1.337.64-2.085.79-.598-.64-1.45-1.04-2.396-1.04-1.812 0-3.282 1.47-3.282 3.28 0 .26.03.51.085.75-2.728-.13-5.147-1.44-6.766-3.42C.83 2.58.67 3.14.67 3.75c0 1.14.58 2.143 1.46 2.732-.538-.017-1.045-.165-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.22-.276.074-.566.114-.865.114-.21 0-.41-.02-.61-.058.42 1.304 1.63 2.253 3.07 2.28-1.12.88-2.54 1.404-4.07 1.404-.26 0-.52-.015-.78-.045 1.46.93 3.18 1.474 5.04 1.474 6.04 0 9.34-5 9.34-9.33 0-.14 0-.28-.01-.42.64-.46 1.2-1.04 1.64-1.7z" fill-rule="nonzero"/></svg></span>
  <span class="label">Twitter</span>
</a>
</li>
  

  <li>
    
      <a href="/feed.xml" title="Atom Feed">
        <span class="icon icon--rss"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M12.8 16C12.8 8.978 7.022 3.2 0 3.2V0c8.777 0 16 7.223 16 16h-3.2zM2.194 11.61c1.21 0 2.195.985 2.195 2.196 0 1.21-.99 2.194-2.2 2.194C.98 16 0 15.017 0 13.806c0-1.21.983-2.195 2.194-2.195zM10.606 16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818 0 10.606 4.79 10.606 10.607z"/></svg></span>
        <span class="label">Subscribe</span>
      </a>
    
  </li>
</ul>

      </div>
    </div>

    <div class="canvas">
      <div class="wrapper">
        

<header id="masthead">
  <div class="inner">
    <div class="title-area">
      
        <p class="site-title">
          <a href="/">
            <img src="/images/avatar.jpg" alt="" class="site-logo">
            <span>Musings of a Software Development Manager</span>
          </a>
        </p>
      
    </div>
  </div>
</header>

        <div class="initial-content">
          


<main id="main" class="page-content" aria-label="Content">
  <div class="index inner">
    <div></div>

    <div>
      <div class="entries">
        
          
          
  

<article class="entry">
  <header class="entry-header">
    <h3 class="entry-title">
      <a href="/2011/11/19/stubbing-partials-with-rspec-in-rails-view-tests/" rel="bookmark">Stubbing Partials with RSpec in Rails View Tests
</a>
    </h3>
  </header>
  <footer class="entry-meta">
    <ul>
    
      <li><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="379 72 16 16"><g><g><path fill="none" d="M380.8,86.7h12.3v-8.8h-12.3V86.7z M389.5,78.8h1.7v1.4h-1.7V78.8z M389.5,81.3h1.7v1.4h-1.7V81.3z M389.5,83.8h1.7v1.4h-1.7V83.8z M386.1,78.8h1.7v1.4h-1.7V78.8z M386.1,81.3h1.7v1.4h-1.7V81.3z M386.1,83.8h1.7v1.4h-1.7V83.8z M382.8,78.8h1.7v1.4h-1.7V78.8z M382.8,81.3h1.7v1.4h-1.7V81.3z M382.8,83.8h1.7v1.4h-1.7V83.8z"/><polygon fill="none" points="384.7 75.1 383.4 75.1 383.4 74.3 380.8 74.3 380.8 76.6 393.2 76.6 393.2 74.3 390.6 74.3 390.6 75.1 389.3 75.1 389.3 74.3 384.7 74.3"/><rect x="382.8" y="78.8" width="1.7" height="1.4"/><rect x="386.1" y="78.8" width="1.7" height="1.4"/><rect x="389.5" y="78.8" width="1.7" height="1.4"/><rect x="382.8" y="81.3" width="1.7" height="1.4"/><rect x="386.1" y="81.3" width="1.7" height="1.4"/><rect x="389.5" y="81.3" width="1.7" height="1.4"/><rect x="382.8" y="83.8" width="1.7" height="1.4"/><rect x="386.1" y="83.8" width="1.7" height="1.4"/><rect x="389.5" y="83.8" width="1.7" height="1.4"/><path d="M383.4,72v1.1h-3.8V88h14.9V73.1h-3.8V72h-1.3v1.1h-4.7V72H383.4z M393.2,86.7h-12.3v-8.8h12.3L393.2,86.7L393.2,86.7z M389.3,74.3v0.8h1.3v-0.8h2.5v2.3h-12.3v-2.3h2.5v0.8h1.3v-0.8H389.3z"/></g></g></svg></span><time class="entry-time" datetime="2011-11-19T14:59:51+00:00">November 19, 2011</time></li>
    
    
    </ul>
  </footer>
  <div class="entry-excerpt">
      <p>Working with my pair yesterday we ran into an issue testing a view that pulled in several partials. In the interest of making progress we punted after about half an hour of trying to setup expectations on the partials and just tested the negative cases where we didn’t have to worry about the partials being called. Intellectual curiosity and not wanting to leave the views lightly tested I dived into seeing how we could effectively test that the partials were called as expected.</p>

<p>Say you have a view like the following:</p>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"content"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"page_title"</span> <span class="na">style=</span><span class="s">"padding-bottom: 20px;"</span><span class="nt">&gt;</span>
<span class="nt">&lt;h2&gt;</span>Books<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;</span> <span class="err">%=</span> <span class="na">render</span> <span class="na">:partial =</span><span class="s">'tabs'</span> <span class="err">%</span><span class="nt">&gt;</span>;

<span class="nt">&lt;</span> <span class="err">%</span> <span class="na">if</span> <span class="err">@</span><span class="na">books.empty</span><span class="err">?</span> <span class="na">-</span><span class="err">%</span><span class="nt">&gt;</span>;
<span class="nt">&lt;em&gt;</span>No Books<span class="nt">&lt;/em&gt;&lt;em&gt;</span>
<span class="nt">&lt;</span> <span class="err">%</span> <span class="na">else</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span> <span class="err">%=</span> <span class="na">pagination_links = </span><span class="s">render</span> <span class="na">:partial =</span><span class="err">&gt; </span><span class="s">'shared/pagination'</span><span class="err">,</span> <span class="na">:object =</span><span class="err">&gt; </span><span class="s">@books</span> <span class="err">%</span><span class="nt">&gt;</span>;
<span class="nt">&lt;</span> <span class="err">%=</span> <span class="na">render</span> <span class="na">:partial =</span><span class="err">&gt; </span><span class="s">"book_rows"</span><span class="err">,</span> <span class="na">:locals =</span><span class="err">&gt; </span><span class="s">{:books</span> <span class="err">=</span><span class="nt">&gt;</span> @books} %&gt;
<span class="nt">&lt;</span> <span class="err">%=</span> <span class="na">pagination_links</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span> <span class="err">%</span> <span class="na">end</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/em&gt;</span>

<span class="nt">&lt;/div&gt;</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>You want to test the conditional to see that the partials to display the list of books work correctly. You don’t want to worry about concerns like setting up the books collection, and you might even want to stub out the call to the partial that displays the tabs a the top of the page.</p>

<p>The Rspec example group for this looks like the following:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre><span class="nb">require</span> <span class="s1">'spec_helper'</span>

<span class="n">describe</span> <span class="s2">"books.rhtml"</span> <span class="k">do</span>
  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">assigns</span><span class="p">[</span><span class="ss">:books</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">"with no books"</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">"should display 'No Books' message"</span> <span class="k">do</span>
      <span class="n">render</span>
      <span class="n">response</span><span class="p">.</span><span class="nf">should</span> <span class="n">have_text</span><span class="p">(</span><span class="sr">/No Books/</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">"with books"</span> <span class="k">do</span>
    <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">assigns</span><span class="p">[</span><span class="ss">:books</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="no">Factory</span><span class="p">.</span><span class="nf">build</span><span class="p">(</span><span class="ss">:book</span><span class="p">)]</span>
      <span class="n">template</span><span class="p">.</span><span class="nf">stub</span><span class="p">(</span><span class="ss">:render</span><span class="p">).</span><span class="nf">and_call_original</span>
      <span class="n">template</span><span class="p">.</span><span class="nf">stub</span><span class="p">(</span><span class="ss">:render</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">hash_including</span><span class="p">(</span><span class="ss">:partial</span> <span class="o">=&gt;</span> <span class="s2">"tabs"</span><span class="p">))</span>
      <span class="n">template</span><span class="p">.</span><span class="nf">stub</span><span class="p">(</span><span class="ss">:render</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">hash_including</span><span class="p">(</span><span class="ss">:partial</span> <span class="o">=&gt;</span> <span class="s2">"shared/pagination"</span><span class="p">))</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">"should render book rows"</span> <span class="k">do</span>
      <span class="n">template</span><span class="p">.</span><span class="nf">should_receive</span><span class="p">(</span><span class="ss">:render</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">hash_including</span><span class="p">(</span><span class="ss">:partial</span> <span class="o">=&gt;</span> <span class="s2">"book_rows"</span><span class="p">))</span>
      <span class="n">render</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>The key find was to use with(:hash_including()) which I found from a helpful link at <a href="http://stackoverflow.com/questions/1893544/rspec-partials-problem">Stack Overflow</a>.</p>

  </div>
</article>


  

<article class="entry">
  <header class="entry-header">
    <h3 class="entry-title">
      <a href="/2011/09/17/breaking-the-build-at-the-new-job/" rel="bookmark">Breaking the Build at the New Job
</a>
    </h3>
  </header>
  <footer class="entry-meta">
    <ul>
    
      <li><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="379 72 16 16"><g><g><path fill="none" d="M380.8,86.7h12.3v-8.8h-12.3V86.7z M389.5,78.8h1.7v1.4h-1.7V78.8z M389.5,81.3h1.7v1.4h-1.7V81.3z M389.5,83.8h1.7v1.4h-1.7V83.8z M386.1,78.8h1.7v1.4h-1.7V78.8z M386.1,81.3h1.7v1.4h-1.7V81.3z M386.1,83.8h1.7v1.4h-1.7V83.8z M382.8,78.8h1.7v1.4h-1.7V78.8z M382.8,81.3h1.7v1.4h-1.7V81.3z M382.8,83.8h1.7v1.4h-1.7V83.8z"/><polygon fill="none" points="384.7 75.1 383.4 75.1 383.4 74.3 380.8 74.3 380.8 76.6 393.2 76.6 393.2 74.3 390.6 74.3 390.6 75.1 389.3 75.1 389.3 74.3 384.7 74.3"/><rect x="382.8" y="78.8" width="1.7" height="1.4"/><rect x="386.1" y="78.8" width="1.7" height="1.4"/><rect x="389.5" y="78.8" width="1.7" height="1.4"/><rect x="382.8" y="81.3" width="1.7" height="1.4"/><rect x="386.1" y="81.3" width="1.7" height="1.4"/><rect x="389.5" y="81.3" width="1.7" height="1.4"/><rect x="382.8" y="83.8" width="1.7" height="1.4"/><rect x="386.1" y="83.8" width="1.7" height="1.4"/><rect x="389.5" y="83.8" width="1.7" height="1.4"/><path d="M383.4,72v1.1h-3.8V88h14.9V73.1h-3.8V72h-1.3v1.1h-4.7V72H383.4z M393.2,86.7h-12.3v-8.8h12.3L393.2,86.7L393.2,86.7z M389.3,74.3v0.8h1.3v-0.8h2.5v2.3h-12.3v-2.3h2.5v0.8h1.3v-0.8H389.3z"/></g></g></svg></span><time class="entry-time" datetime="2011-09-17T19:43:55+00:00">September 17, 2011</time></li>
    
    
    </ul>
  </footer>
  <div class="entry-excerpt">
      <div align="center">
  <img src="/images/i_broke_the_build.jpg" alt="I broke the build" /><br /> <!-- Picture taken by http://www.flickr.com/photos/dhaun/5626938236/in/photostream/ -->
</div>

<p>My first break of the CI build on a new team came about two weeks into starting the new job. We had made a small change to a dynamically created URL on a single page of the application. Normally this would fall into the category of “too simple to test” for me. My pairing partner pointed out when we started the story that we should put a test in for the change. I argued that changing a URL was too simple a change to bother writing a test for. He disagreed, but let me go ahead after some further discussion. After checking in the feature, about an hour later a developer on the other side of the room piped up with “Someone broke the build.” My pairing partner smiled and said, “I guess we didn’t need to test that.”</p>

<p>It turned out there was another test I didn’t realize had a dependency on that same link and by changing it we had broken an assertion on the specific URL. A bit embarrassed I learned an important lesson. My assumptions about “too simple to break” needed some adjusting.</p>

<p>Over the course of several weeks I came to appreciate that many things were worth testing. A particularly revealing example was testing a new javascript dialog. Javascript is always a pain point when it comes to unit testing, and I’ve often let that coverage of javascript functionality be covered by functional tests usually with Selenium. My pairing partner walked me through a complete TDD approach asserting every part of the function we created and the various DOM elements we used to create it. I did ask a few questions about whether we really needed to test that we had created a DOM element in some exact order at points, but he was firm about testing in every piece. By the end of the feature I had a new appreciation for doing very low level unit testing.</p>

<p>I love that I’m being challenged on not writing enough tests. For so long in past shops I was the hardcore TDD advocate constantly questioned about the real need for testing some component. Now I’m learning to test in even very small changes.</p>

  </div>
</article>


  

<article class="entry">
  <header class="entry-header">
    <h3 class="entry-title">
      <a href="/2011/08/07/cardboard-boxes-and-modern-web-frameworks/" rel="bookmark">Cardboard Boxes and Modern Web Frameworks
</a>
    </h3>
  </header>
  <footer class="entry-meta">
    <ul>
    
      <li><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="379 72 16 16"><g><g><path fill="none" d="M380.8,86.7h12.3v-8.8h-12.3V86.7z M389.5,78.8h1.7v1.4h-1.7V78.8z M389.5,81.3h1.7v1.4h-1.7V81.3z M389.5,83.8h1.7v1.4h-1.7V83.8z M386.1,78.8h1.7v1.4h-1.7V78.8z M386.1,81.3h1.7v1.4h-1.7V81.3z M386.1,83.8h1.7v1.4h-1.7V83.8z M382.8,78.8h1.7v1.4h-1.7V78.8z M382.8,81.3h1.7v1.4h-1.7V81.3z M382.8,83.8h1.7v1.4h-1.7V83.8z"/><polygon fill="none" points="384.7 75.1 383.4 75.1 383.4 74.3 380.8 74.3 380.8 76.6 393.2 76.6 393.2 74.3 390.6 74.3 390.6 75.1 389.3 75.1 389.3 74.3 384.7 74.3"/><rect x="382.8" y="78.8" width="1.7" height="1.4"/><rect x="386.1" y="78.8" width="1.7" height="1.4"/><rect x="389.5" y="78.8" width="1.7" height="1.4"/><rect x="382.8" y="81.3" width="1.7" height="1.4"/><rect x="386.1" y="81.3" width="1.7" height="1.4"/><rect x="389.5" y="81.3" width="1.7" height="1.4"/><rect x="382.8" y="83.8" width="1.7" height="1.4"/><rect x="386.1" y="83.8" width="1.7" height="1.4"/><rect x="389.5" y="83.8" width="1.7" height="1.4"/><path d="M383.4,72v1.1h-3.8V88h14.9V73.1h-3.8V72h-1.3v1.1h-4.7V72H383.4z M393.2,86.7h-12.3v-8.8h12.3L393.2,86.7L393.2,86.7z M389.3,74.3v0.8h1.3v-0.8h2.5v2.3h-12.3v-2.3h2.5v0.8h1.3v-0.8H389.3z"/></g></g></svg></span><time class="entry-time" datetime="2011-08-07T06:29:24+00:00">August 7, 2011</time></li>
    
    
    </ul>
  </footer>
  <div class="entry-excerpt">
      <p>My daughter spent an hour the other day cutting holes, drawing red bricks, and pasting grass along the bottom of a simple cardboard box. It’s a common story among parents, especially of small children that despite spending a lot of money on a gift, the kid ends up enjoying the box and ignoring the toy.</p>

<p>I’ve noticed a common quality of many newer web frameworks is that they provide you with a nice box to build from. Typically:</p>

<ul>
  <li>A default structure so you know where to find the models, views, controllers, extra libraries, etc.</li>
  <li>A command line for generating stubs, running tests, and deploying.</li>
  <li>A plugin system for easily adding functionality from swapping out javascript libraries to adding a security system.</li>
</ul>

<p>Though there are probably others I’m aware of this model being used by Spring Roo, the Play Framework, Gryphon, Grails, and Rails. I don’t claim to be a historian on this, but Rails was my first experience with this style and I assume to be the originator of the approach.</p>

<p>The benefits of this approach are obvious from the first time you start off with a Hello World tutorial. For one you generally have a single download for the framework. After unpacking you’re able to use the command line to generate your Hello World controller, find the view in a predefined location, add the Hello World line, and fire up the application from the command line. Passing the 5 minute test is pretty important if you expect developers to give your framework a chance.</p>

<p>As a consultant working on numerous legacy code projects, there’s always the groan moment when you start looking into the code and you realize its non-obvious where to find things. I’ve seen libraries sprinkled about at random, key configuration files that were supposed to be moved into the users home directory, model classes mixed in with controllers, and a host of other inconsistencies. With a framework that reinforces the default structures it becomes easy to find things and much easier for plugin-authors to write plug-ins that make the framework much more valuable.</p>

<p>Finally, the plugin system is a critical part of new frameworks. Being able to add security framework on the fly, swap out your testing framework, or simply add in a nicer date library really starts to make things feel like magic. Indeed among these frameworks they are starting to push more and more modularity into the plugin systems to allow for the framework to evolve better over time.</p>

<p>I hope this trend continues in the world of web frameworks, as I really like a nice box to start a project from.</p>

  </div>
</article>


  

<article class="entry">
  <header class="entry-header">
    <h3 class="entry-title">
      <a href="/2011/06/06/mock-with-spock/" rel="bookmark">Mock With Spock
</a>
    </h3>
  </header>
  <footer class="entry-meta">
    <ul>
    
      <li><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="379 72 16 16"><g><g><path fill="none" d="M380.8,86.7h12.3v-8.8h-12.3V86.7z M389.5,78.8h1.7v1.4h-1.7V78.8z M389.5,81.3h1.7v1.4h-1.7V81.3z M389.5,83.8h1.7v1.4h-1.7V83.8z M386.1,78.8h1.7v1.4h-1.7V78.8z M386.1,81.3h1.7v1.4h-1.7V81.3z M386.1,83.8h1.7v1.4h-1.7V83.8z M382.8,78.8h1.7v1.4h-1.7V78.8z M382.8,81.3h1.7v1.4h-1.7V81.3z M382.8,83.8h1.7v1.4h-1.7V83.8z"/><polygon fill="none" points="384.7 75.1 383.4 75.1 383.4 74.3 380.8 74.3 380.8 76.6 393.2 76.6 393.2 74.3 390.6 74.3 390.6 75.1 389.3 75.1 389.3 74.3 384.7 74.3"/><rect x="382.8" y="78.8" width="1.7" height="1.4"/><rect x="386.1" y="78.8" width="1.7" height="1.4"/><rect x="389.5" y="78.8" width="1.7" height="1.4"/><rect x="382.8" y="81.3" width="1.7" height="1.4"/><rect x="386.1" y="81.3" width="1.7" height="1.4"/><rect x="389.5" y="81.3" width="1.7" height="1.4"/><rect x="382.8" y="83.8" width="1.7" height="1.4"/><rect x="386.1" y="83.8" width="1.7" height="1.4"/><rect x="389.5" y="83.8" width="1.7" height="1.4"/><path d="M383.4,72v1.1h-3.8V88h14.9V73.1h-3.8V72h-1.3v1.1h-4.7V72H383.4z M393.2,86.7h-12.3v-8.8h12.3L393.2,86.7L393.2,86.7z M389.3,74.3v0.8h1.3v-0.8h2.5v2.3h-12.3v-2.3h2.5v0.8h1.3v-0.8H389.3z"/></g></g></svg></span><time class="entry-time" datetime="2011-06-06T19:38:16+00:00">June 6, 2011</time></li>
    
    
    </ul>
  </footer>
  <div class="entry-excerpt">
      <p>My default rule with mocking is to try to stick to stubs where possible. I don’t enjoy having to setup and verify interactions with mocks, but sometimes you have some code where that’s exactly what you need to do. I’ve used many frameworks in Java over the years from EasyMock to Mockito, but I was quite happy with how easy it was to do in Spock. I recently found myself having to build a test harness around some legacy code. The real world code was more involved, but it looked something like this:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">addDefaultQuestions</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">categoryDao</span><span class="o">.</span><span class="na">getCategory</span><span class="o">(</span><span class="n">category</span><span class="o">.</span><span class="na">getId</span><span class="o">()).</span><span class="na">getQuestions</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Question</span> <span class="n">question</span> <span class="o">:</span> <span class="n">category</span><span class="o">.</span><span class="na">getQuestions</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">question</span><span class="o">.</span><span class="na">isDefaultQuestion</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">categoryDao</span><span class="o">.</span><span class="na">addQuestion</span><span class="o">(</span><span class="n">question</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">categoryDao</span><span class="o">.</span><span class="na">addQuestion</span><span class="o">(</span><span class="n">question</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>The method is taking a category, checking if any questions related to the category exist in the database and then saving all the questions with a valid flag set to true or false. Not unusual in a typical corporate application, but I want to test two things:</p>

<ul>
  <li>I can add new questions to the database with the proper valid flag.</li>
  <li>If the database category already has some questions then do nothing.</li>
</ul>

<p>After walking through the Spock <a href="http://code.google.com/p/spock/wiki/Interactions">mocking documentation</a> I had a pretty good sense of the approach. In Spock it’s referred to as interactions, but it doesn’t follow the typical expect-run-verify pattern. You just verify what you need to if you need to. And given a choice I prefer not to have to verify the mock at all.</p>

<p>With this code I needed to mock the categoryDao which used straight JDBC and made calls to the real database. That meant I needed a way to verify that the questions were added correctly with calls to the categoryDao. Hence I needed the power of an actual mock and not just a stub class.</p>

<p>The first test would show that I could save new questions in a category to the database:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="kt">def</span> <span class="s2">"should only insert new default questions"</span><span class="o">()</span> <span class="o">{</span>
  <span class="nl">given:</span>
  <span class="kt">def</span> <span class="n">question1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Question</span><span class="o">(</span><span class="nl">defaultQuestion:</span> <span class="kc">true</span><span class="o">)</span>
  <span class="kt">def</span> <span class="n">question2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Question</span><span class="o">(</span><span class="nl">defaultQuestion:</span> <span class="kc">false</span><span class="o">)</span>
  <span class="kt">def</span> <span class="n">category</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Category</span><span class="o">(</span><span class="nl">questions:</span> <span class="o">[</span><span class="n">question1</span><span class="o">,</span> <span class="n">question2</span><span class="o">])</span>

  <span class="n">CategoryDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">Mock</span><span class="o">()</span>
  <span class="n">dao</span><span class="o">.</span><span class="na">getCategory</span><span class="o">(</span><span class="n">_</span><span class="o">)</span> <span class="o">&gt;&gt;</span> <span class="k">new</span> <span class="n">Category</span><span class="o">()</span>

  <span class="n">CategoryService</span> <span class="n">service</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CategoryService</span><span class="o">()</span>
  <span class="n">service</span><span class="o">.</span><span class="na">setCategoryDao</span><span class="o">(</span><span class="n">dao</span><span class="o">)</span>

  <span class="nl">when:</span>
  <span class="n">service</span><span class="o">.</span><span class="na">addDefaultQuestions</span><span class="o">(</span><span class="n">category</span><span class="o">)</span>

  <span class="nl">then:</span>
  <span class="mi">1</span> <span class="o">*</span> <span class="n">dao</span><span class="o">.</span><span class="na">addQuestion</span><span class="o">(</span><span class="n">_</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
  <span class="mi">1</span> <span class="o">*</span> <span class="n">dao</span><span class="o">.</span><span class="na">addQuestion</span><span class="o">(</span><span class="n">_</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>So the steps are:</p>

<ol>
  <li>Setup a Category object with two questions.</li>
  <li>Create a mock dao.</li>
  <li>Define a method and its default return value on the mock DAO.
    <ol>
      <li>We define arguments to getCategory() with a wildcard operator the underscore standing in for an id.</li>
      <li>Then with the right shift operator (») we define that we will return a newly created Category object.</li>
    </ol>
  </li>
  <li>Inject the mock into the service class we’re testing.</li>
  <li>Finally, we make verifications on the addQuestion() method by just stating the number of times we expect the method to be called with a given set of arguments, again reusing the wildcard underscore character.</li>
</ol>

<p>You can even specify the particular order you expect by breaking the verifications into separate <strong>then:</strong> blocks. For this example it wouldn’t matter on the order, but in case it did the last when then block would change to:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="nl">when:</span>
  <span class="n">service</span><span class="o">.</span><span class="na">addDefaultQuestions</span><span class="o">(</span><span class="n">category</span><span class="o">)</span>

  <span class="nl">then:</span>
  <span class="mi">1</span> <span class="o">*</span> <span class="n">dao</span><span class="o">.</span><span class="na">addQuestion</span><span class="o">(</span><span class="n">_</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>

  <span class="nl">then:</span>
  <span class="mi">1</span> <span class="o">*</span> <span class="n">dao</span><span class="o">.</span><span class="na">addQuestion</span><span class="o">(</span><span class="n">_</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<div class="codecolorer-container groovy vibrant overflow-off" style="overflow:auto;white-space:nowrap;">

And to round out testing the legacy Java code we need to test the negative example where it should do nothing if there are already questions in the database for the given category.


<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre> <span class="kt">def</span> <span class="s2">"should add no questions if questions are already in database"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">given:</span>
    <span class="kt">def</span> <span class="n">question1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Question</span><span class="o">(</span><span class="nl">defaultQuestion:</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">question2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Question</span><span class="o">(</span><span class="nl">defaultQuestion:</span> <span class="kc">false</span><span class="o">)</span>

    <span class="n">CategoryDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">Mock</span><span class="o">()</span>
    <span class="n">dao</span><span class="o">.</span><span class="na">getCategory</span><span class="o">(</span><span class="n">_</span><span class="o">)</span> <span class="o">&gt;&gt;</span> <span class="k">new</span> <span class="n">Category</span><span class="o">(</span><span class="nl">questions:</span> <span class="o">[</span><span class="n">question1</span><span class="o">])</span>

    <span class="n">CategoryService</span> <span class="n">service</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CategoryService</span><span class="o">()</span>
    <span class="n">service</span><span class="o">.</span><span class="na">setCategoryDao</span><span class="o">(</span><span class="n">dao</span><span class="o">)</span>

    <span class="nl">when:</span>
    <span class="n">service</span><span class="o">.</span><span class="na">addDefaultQuestions</span><span class="o">(</span><span class="k">new</span> <span class="n">Category</span><span class="o">(</span><span class="nl">questions:</span> <span class="o">[</span><span class="n">question2</span><span class="o">]))</span>

    <span class="nl">then:</span>
    <span class="o">*</span> <span class="n">dao</span><span class="o">.</span><span class="na">addQuestion</span><span class="o">(</span><span class="n">_</span><span class="o">,</span><span class="n">_</span><span class="o">)</span>

  <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></figure>


So we can test for the negative case by just verifying that addQuestion was called zero times.
</div>

  </div>
</article>


  

<article class="entry">
  <header class="entry-header">
    <h3 class="entry-title">
      <a href="/2011/04/17/grails-unit-testing-mocking-with-metaclass-stubs/" rel="bookmark">Grails Unit Testing: Mocking With MetaClass Stubs
</a>
    </h3>
  </header>
  <footer class="entry-meta">
    <ul>
    
      <li><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="379 72 16 16"><g><g><path fill="none" d="M380.8,86.7h12.3v-8.8h-12.3V86.7z M389.5,78.8h1.7v1.4h-1.7V78.8z M389.5,81.3h1.7v1.4h-1.7V81.3z M389.5,83.8h1.7v1.4h-1.7V83.8z M386.1,78.8h1.7v1.4h-1.7V78.8z M386.1,81.3h1.7v1.4h-1.7V81.3z M386.1,83.8h1.7v1.4h-1.7V83.8z M382.8,78.8h1.7v1.4h-1.7V78.8z M382.8,81.3h1.7v1.4h-1.7V81.3z M382.8,83.8h1.7v1.4h-1.7V83.8z"/><polygon fill="none" points="384.7 75.1 383.4 75.1 383.4 74.3 380.8 74.3 380.8 76.6 393.2 76.6 393.2 74.3 390.6 74.3 390.6 75.1 389.3 75.1 389.3 74.3 384.7 74.3"/><rect x="382.8" y="78.8" width="1.7" height="1.4"/><rect x="386.1" y="78.8" width="1.7" height="1.4"/><rect x="389.5" y="78.8" width="1.7" height="1.4"/><rect x="382.8" y="81.3" width="1.7" height="1.4"/><rect x="386.1" y="81.3" width="1.7" height="1.4"/><rect x="389.5" y="81.3" width="1.7" height="1.4"/><rect x="382.8" y="83.8" width="1.7" height="1.4"/><rect x="386.1" y="83.8" width="1.7" height="1.4"/><rect x="389.5" y="83.8" width="1.7" height="1.4"/><path d="M383.4,72v1.1h-3.8V88h14.9V73.1h-3.8V72h-1.3v1.1h-4.7V72H383.4z M393.2,86.7h-12.3v-8.8h12.3L393.2,86.7L393.2,86.7z M389.3,74.3v0.8h1.3v-0.8h2.5v2.3h-12.3v-2.3h2.5v0.8h1.3v-0.8H389.3z"/></g></g></svg></span><time class="entry-time" datetime="2011-04-17T13:06:21+00:00">April 17, 2011</time></li>
    
    
    </ul>
  </footer>
  <div class="entry-excerpt">
      <p>On a recent project I ran into issues with testing controllers in Grails. Starting test first, I spent some early time figuring out how much support there was out of the box for unit testing Grails domain classes and controllers. I setup <a href="http://code.google.com/p/spock/">Spock</a> as a plugin and plunged in. I was dealing with a legacy database which had 100% compound primary keys so many of the findBy type operations that are well supported for controller testing are of no help. Often I found I needed to mock a call to a find or findAll with HQL syntax or a criteria call. I knew metaClass mocking could work here, but I wanted to understand better how that would impact the rest of the code after I started replacing methods on the fly. Turns out Grails unit testing has built in support for cleaning up metaClass hacking after every test with the registerMetaClass() method in GrailsUnitTestCase. <a href="http://mrhaki.blogspot.com/">Mrhaki</a> has a good <a href="http://mrhaki.blogspot.com/2010/03/grails-goodness-using-metaclass-with.html">post</a> on this. Here’s an Spock example:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">grails.plugin.spock.ControllerSpec</span>


<span class="kd">class</span> <span class="nc">ContractControllerSpec</span> <span class="kd">extends</span> <span class="n">ControllerSpec</span> <span class="o">{</span>

  <span class="kt">def</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">registerMetaClass</span> <span class="n">Contract</span>
  <span class="o">}</span>

 <span class="kt">def</span> <span class="s2">"validateContract() returns true for an existing contract"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">given:</span>
    <span class="n">mockDomain</span><span class="o">(</span><span class="n">Contract</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Contract</span><span class="o">(</span><span class="nl">division:</span> <span class="s1">'33'</span><span class="o">,</span> <span class="nl">unit:</span> <span class="s1">'99'</span><span class="o">,</span> <span class="nl">contractNumber:</span> <span class="s1">'C7777777'</span><span class="o">).</span><span class="na">save</span><span class="o">(</span><span class="nl">flush:</span> <span class="kc">true</span><span class="o">)</span>
    <span class="n">controller</span><span class="o">.</span><span class="na">params</span><span class="o">.</span><span class="na">division</span> <span class="o">=</span> <span class="s1">'33'</span>
    <span class="n">controller</span><span class="o">.</span><span class="na">params</span><span class="o">.</span><span class="na">unit</span> <span class="o">=</span> <span class="s1">'99'</span>
    <span class="n">controller</span><span class="o">.</span><span class="na">params</span><span class="o">.</span><span class="na">contractNumber</span> <span class="o">=</span> <span class="s1">'C7777777'</span>
    <span class="n">Contract</span><span class="o">.</span><span class="na">metaClass</span><span class="o">.</span><span class="na">static</span><span class="o">.</span><span class="na">find</span> <span class="o">=</span> <span class="o">{</span> <span class="n">String</span> <span class="n">query</span><span class="o">,</span> <span class="n">Map</span> <span class="n">namedArgs</span> <span class="o">-&gt;</span> <span class="n">contract</span> <span class="o">}</span>

    <span class="nl">when:</span>
    <span class="n">controller</span><span class="o">.</span><span class="na">validateContract</span><span class="o">()</span>

    <span class="nl">then:</span>
    <span class="s2">"TRUE"</span> <span class="o">==</span> <span class="n">controller</span><span class="o">.</span><span class="na">response</span><span class="o">.</span><span class="na">contentAsString</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Grails has support for the same idea using mockFor(), but the syntax is much like EasyMock. The same test would look like:</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">grails.plugin.spock.ControllerSpec</span>


<span class="kd">class</span> <span class="nc">ContractControllerSpec</span> <span class="kd">extends</span> <span class="n">ControllerSpec</span> <span class="o">{</span>

 <span class="kt">def</span> <span class="s2">"validateContract() returns true for an existing contract"</span><span class="o">()</span> <span class="o">{</span>
    <span class="nl">given:</span>
    <span class="n">mockDomain</span><span class="o">(</span><span class="n">Contract</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Contract</span><span class="o">(</span><span class="nl">division:</span> <span class="s1">'33'</span><span class="o">,</span> <span class="nl">unit:</span> <span class="s1">'99'</span><span class="o">,</span> <span class="nl">contractNumber:</span> <span class="s1">'C7777777'</span><span class="o">).</span><span class="na">save</span><span class="o">(</span><span class="nl">flush:</span> <span class="kc">true</span><span class="o">)</span>
    <span class="n">controller</span><span class="o">.</span><span class="na">params</span><span class="o">.</span><span class="na">division</span> <span class="o">=</span> <span class="s1">'33'</span>
    <span class="n">controller</span><span class="o">.</span><span class="na">params</span><span class="o">.</span><span class="na">unit</span> <span class="o">=</span> <span class="s1">'99'</span>
    <span class="n">controller</span><span class="o">.</span><span class="na">params</span><span class="o">.</span><span class="na">contractNumber</span> <span class="o">=</span> <span class="s1">'C7777777'</span>

  <span class="c1">// EasyMock like syntax</span>
  <span class="kt">def</span> <span class="n">mockContract</span> <span class="o">=</span> <span class="n">mockFor</span><span class="o">(</span><span class="n">Contract</span><span class="o">)</span>
    <span class="n">mockContract</span><span class="o">.</span><span class="na">demand</span><span class="o">.</span><span class="na">static</span><span class="o">.</span><span class="na">find</span><span class="o">(..</span><span class="mi">5</span><span class="o">)</span> <span class="o">{</span> <span class="n">String</span> <span class="n">query</span><span class="o">,</span> <span class="n">Map</span> <span class="n">namedArgs</span> <span class="o">-&gt;</span> <span class="kc">null</span> <span class="o">}</span>

    <span class="nl">when:</span>
    <span class="n">controller</span><span class="o">.</span><span class="na">validateContract</span><span class="o">()</span>

    <span class="nl">then:</span>
    <span class="s2">"TRUE"</span> <span class="o">==</span> <span class="n">controller</span><span class="o">.</span><span class="na">response</span><span class="o">.</span><span class="na">contentAsString</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>For pure stubs I prefer the syntax of just using MetaClass. I often don’t care about validating the exact calls to the dependent class so I don’t really want a full mock. You don’t need a call to registerMetaClass() because mockFor() does this for you.</p>

  </div>
</article>



<!-- Pagination links -->
<nav class="pager">
  <ul>
    <!-- Page: 12 of 152 -->
    
      <li><a href="/page11/" class="previous"><span class="icon icon--arrow-right"><svg xmlns="http://www.w3.org/2000/svg" viewBox="430 -22.8 16 16"><path d="M433.4-15.7c-.2.2-.4.5-.4.9 0 .3.1.6.4.9l6.7 6.7c.2.3.5.4.9.4.3 0 .6-.1.9-.4l.8-.8c.3-.2.4-.5.4-.9 0-.3-.1-.6-.4-.9l-5-5 5-5c.3-.2.4-.5.4-.9 0-.3-.1-.6-.4-.9l-.8-.8c-.2-.3-.5-.4-.9-.4-.3 0-.7.1-.9.4l-6.7 6.7z"/></svg></span> Newer</a></li>
    
    
      <li><a href="/page13/" class="next">Older <span class="icon icon--arrow-right"><svg xmlns="http://www.w3.org/2000/svg" viewBox="50.4 -114.8 16 16"><path d="M63.1-107.7l-6.7-6.7c-.2-.3-.6-.4-.9-.4-.4 0-.7.1-.9.4l-.8.8c-.3.3-.4.6-.4.9 0 .4.1.7.4.9l5 5-5 5c-.3.3-.4.6-.4.9 0 .4.1.7.4.9l.8.8c.3.3.6.4.9.4.4 0 .7-.1.9-.4l6.7-6.7c.3-.3.4-.6.4-.9 0-.4-.2-.7-.4-.9z"/></svg></span></a></li>
    
  </ul>
</nav>
        
      </div>
    </div>

    <footer id="footer" class="site-footer">
  <div class="inner">
    <div class="copyright">
      
        <p>&copy; 2026 Musings of a Software Development Manager.</p>
      
    </div>
  </div>
</footer>

  </div>
</main>

        </div>
      </div>
    </div>

    

<script async src="/assets/javascripts/main.js"></script>




  </body>

</html>
